{% extends 'base.html' %}

{% block content %}
<article class="post-card">
  <div class="post-header">
    <span class="post-author">{{ post.author.username }}</span>
    <time>{{ post.created_at|date:"d.m.Y H:i" }}</time>
  </div>
  <div class="post-content">{{ post.content|linebreaks }}</div>

  <div class="post-actions">
    <form method="post" action="{% url 'like_post' post.id %}">
      {% csrf_token %}
      <button type="submit" class="like-btn {% if post.liked %}liked{% endif %}">
        {% if post.liked %}‚ù§Ô∏è (–û—Ç–º–µ–Ω–∏—Ç—å){% else %}üíô (–õ–∞–π–∫–Ω—É—Ç—å){% endif %}
      </button>
    </form>
    <span>‚ù§Ô∏è {{ post.likes_count }} | üí¨ {{ post.comments_count }}</span>
  </div>

  {% if user.is_authenticated and user == post.author %}
    <div style="margin-top: 16px;">
      <a href="{% url 'post_edit' post.id %}" class="btn btn-secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
      <a href="{% url 'post_delete' post.id %}" class="btn btn-danger" style="margin-left: 8px;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
    </div>
  {% endif %}
</article>

<!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
<h2 id="comments">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ ({{ comments|length }})</h2>

{% for comment in comments %}
  <article class="post-card" style="background: var(--mint);">
    <div class="post-header">
      <span class="post-author">{{ comment.author.username }}</span>
      <time>{{ comment.created_at|date:"d.m.Y H:i" }}</time>
    </div>
    <div class="post-content">{{ comment.content|linebreaks }}</div>

    {% if user.is_authenticated and user == comment.author %}
      <div style="margin-top: 12px;">
        <a href="{% url 'comment_edit' comment.id %}" class="btn-link">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{% url 'comment_delete' comment.id %}" class="btn-link" style="margin-left: 12px; color: var(--btn-danger);">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
      </div>
    {% endif %}
  </article>
{% empty %}
  <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.</p>
{% endfor %}

<!-- –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
{% if user.is_authenticated %}
  <div class="post-card" style="margin-top: 30px;">
    <h3>–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
    <form method="post" style="margin-top: 16px;">
      {% csrf_token %}
      <div class="form-group">
        {{ form.content }}
      </div>
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  </div>
{% else %}
  <p><a href="{% url 'login' %}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
{% endif %}

<a href="{% url 'home' %}" style="display: inline-block; margin-top: 20px;">‚Üê –í—Å–µ –ø–æ—Å—Ç—ã</a>
{% endblock %}